# 调试.NET nanoFramework类库本地代码的指南

## 关于本文档

本文档提供了在调试类库本地代码时有用的指南。无论开发者使用的是VS Code还是其他IDE，都适用。

## 程序集如何成功加载

类库的程序集和托管应用程序的程序集在启动时从FLASH存储器的部署区域加载。当调用`LoadDeploymentAssemblies()`时，部署区域被扫描，所有的“候选”程序集都会进行验证。验证步骤主要包括检查起始标记、有效的头部以及完整程序集的CRC32校验和。只有通过完整验证集的程序集才能被添加到程序集集合中。

在此步骤之后，调用`g_CLR_RT_TypeSystem.ResolveAll()`，类型系统会尝试解析所有的程序集。这意味着所有所需的类型和方法（来自所有的程序集）都可用，并且版本正确。

接下来是调用`g_CLR_RT_TypeSystem.PrepareForExecution()`，只有在所有程序集都能够解析以及所需的类型都可用的情况下才会调用该方法。

## 启动执行引擎

托管应用程序实际上是通过调用`g_CLR_RT_ExecutionEngine.Execute()`来开始执行的。
只要托管代码在执行中，该方法将不会退出。
当执行结束时，可能是由于严重的异常或者没有托管应用程序来执行代码，流程会经过执行引擎调用之后的`CLR_EE_DBG_IS(RebootPending)`行。

## 总结

因此，通过在上述调用点或之后设置断点，开发者可以了解并检查程序集是否正在加载以及托管应用程序是否正在执行。如果出现了问题（例如程序集加载失败），开发者需要深入进行调查以找出根本原因。但这是另一份文档的内容。